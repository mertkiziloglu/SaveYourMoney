<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Recommendation Detail - Save Your Money</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Noto+Sans:wght@400;500;700&family=Fira+Code:wght@400;500;600&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "surface-dark": "#1d2832",
                        "surface-light": "#ffffff",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"],
                        "mono": ["Fira Code", "monospace"],
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        .icon-filled {
            font-variation-settings: 'FILL' 1;
        }

        .code-scroll::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .code-scroll::-webkit-scrollbar-track {
            background: #1e293b;
        }

        .code-scroll::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(12px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeInUp 0.4s ease-out forwards;
        }

        .animate-fade-in-delay-1 {
            animation-delay: 0.1s;
            opacity: 0;
        }

        .animate-fade-in-delay-2 {
            animation-delay: 0.2s;
            opacity: 0;
        }

        .animate-fade-in-delay-3 {
            animation-delay: 0.3s;
            opacity: 0;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white font-display transition-colors duration-200">
    <div class="flex h-screen w-full overflow-hidden">
        <!-- Sidebar -->
        <aside
            class="hidden md:flex flex-col w-64 h-full bg-surface-light dark:bg-[#111a22] border-r border-slate-200 dark:border-[#233648] shrink-0 z-20">
            <div class="p-6 flex items-center gap-3">
                <div class="size-8 bg-primary rounded-lg flex items-center justify-center text-white">
                    <span class="material-symbols-outlined text-xl">savings</span>
                </div>
                <span class="font-bold text-lg tracking-tight text-slate-900 dark:text-white">Save Your Money</span>
            </div>
            <nav class="flex-1 px-4 space-y-2 overflow-y-auto">
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-[#233648] group transition-colors"
                    href="index.html">
                    <span class="material-symbols-outlined group-hover:text-primary">dashboard</span>
                    <span class="text-sm font-medium">Dashboard</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-[#233648] group transition-colors"
                    href="deployments.html">
                    <span class="material-symbols-outlined group-hover:text-primary">layers</span>
                    <span class="text-sm font-medium">Deployments</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-primary/10 text-primary dark:bg-[#233648] dark:text-white"
                    href="recommendations.html">
                    <span class="material-symbols-outlined icon-filled">auto_awesome</span>
                    <span class="text-sm font-medium">Recommendations</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-[#233648] group transition-colors"
                    href="cost-analysis.html">
                    <span class="material-symbols-outlined group-hover:text-primary">attach_money</span>
                    <span class="text-sm font-medium">Cost Analysis</span>
                </a>
            </nav>
            <div class="p-4 border-t border-slate-200 dark:border-[#233648]">
                <div class="flex items-center gap-3">
                    <div
                        class="size-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-sm">
                        SY</div>
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-slate-900 dark:text-white">SaveYourMoney</span>
                        <span class="text-xs text-slate-500 dark:text-slate-400">DevOps Team</span>
                    </div>
                </div>
            </div>
        </aside>

        <div class="flex-1 flex flex-col h-full relative overflow-hidden">
            <!-- Header -->
            <header
                class="h-16 flex items-center justify-between px-6 bg-surface-light dark:bg-[#111a22] border-b border-slate-200 dark:border-[#233648] shrink-0">
                <div class="flex items-center gap-4">
                    <button class="md:hidden text-slate-500 hover:text-primary">
                        <span class="material-symbols-outlined">menu</span>
                    </button>
                    <div class="hidden md:flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400">
                        <a href="recommendations.html" class="hover:text-primary transition-colors">Recommendations</a>
                        <span class="material-symbols-outlined text-[16px]">chevron_right</span>
                        <span>prod-cluster-east-1</span>
                        <span class="material-symbols-outlined text-[16px]">chevron_right</span>
                        <span class="text-slate-900 dark:text-white font-medium"
                            id="breadcrumb-service">Loading...</span>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="relative hidden sm:block">
                        <span
                            class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 material-symbols-outlined text-[20px]">search</span>
                        <input
                            class="h-9 w-64 pl-10 pr-4 rounded-full bg-slate-100 dark:bg-[#233648] border-none text-sm text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-primary/50"
                            placeholder="Search resources..." type="text" />
                    </div>
                    <button
                        onclick="document.documentElement.classList.toggle('dark');localStorage.setItem('theme',document.documentElement.classList.contains('dark')?'dark':'light')"
                        class="size-9 flex items-center justify-center rounded-full text-slate-500 hover:bg-slate-100 dark:hover:bg-[#233648] transition-colors"
                        title="Toggle Dark Mode">
                        <span class="material-symbols-outlined">dark_mode</span>
                    </button>
                    <button
                        class="size-9 flex items-center justify-center rounded-full text-slate-500 hover:bg-slate-100 dark:hover:bg-[#233648] transition-colors relative">
                        <span class="material-symbols-outlined">notifications</span>
                        <span
                            class="absolute top-2 right-2 size-2 bg-red-500 rounded-full border-2 border-white dark:border-[#111a22]"></span>
                    </button>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1 overflow-y-auto bg-background-light dark:bg-background-dark p-6 lg:px-10 pb-20">
                <div class="max-w-[1280px] mx-auto flex flex-col gap-6" id="detail-content">

                    <!-- Service Header -->
                    <div
                        class="flex flex-col lg:flex-row gap-6 justify-between items-start lg:items-center animate-fade-in">
                        <div class="flex flex-col gap-2">
                            <div class="flex items-center gap-3">
                                <a href="recommendations.html"
                                    class="size-9 rounded-lg border border-slate-200 dark:border-[#324d67] flex items-center justify-center text-slate-500 hover:text-primary hover:border-primary transition-colors">
                                    <span class="material-symbols-outlined text-lg">arrow_back</span>
                                </a>
                                <h1 class="text-3xl font-black text-slate-900 dark:text-white tracking-tight"
                                    id="service-title">Loading...</h1>
                                <span class="px-2.5 py-0.5 rounded-full text-xs font-bold" id="health-badge">...</span>
                            </div>
                            <p class="text-slate-500 dark:text-[#92adc9]" id="service-meta">
                                Loading service metadata...
                            </p>
                        </div>
                        <div class="flex flex-wrap items-center gap-3">
                            <div class="flex flex-col items-end mr-4">
                                <span class="text-xs font-medium uppercase tracking-wider text-slate-500">Projected
                                    Savings</span>
                                <span class="text-2xl font-bold text-primary dark:text-primary"
                                    id="projected-savings">-$0<span
                                        class="text-sm font-normal text-slate-400">/mo</span></span>
                            </div>
                            <button onclick="dismissRecommendation()"
                                class="h-11 px-4 rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-700 dark:text-slate-300 font-bold hover:bg-slate-50 dark:hover:bg-[#233648] transition-colors">
                                Dismiss
                            </button>
                            <button onclick="createPR()"
                                class="h-11 px-6 rounded-lg bg-primary hover:bg-primary/90 text-white font-bold shadow-lg shadow-blue-500/20 flex items-center gap-2 transition-all transform active:scale-95">
                                <svg aria-hidden="true" class="size-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path clip-rule="evenodd"
                                        d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.606 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.334.202 2.353.1 2.606.636.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                                        fill-rule="evenodd"></path>
                                </svg>
                                Create Pull Request
                            </button>
                        </div>
                    </div>

                    <!-- Main Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                        <!-- Left Column (2/3) -->
                        <div class="lg:col-span-2 flex flex-col gap-6">

                            <!-- YAML Diff Viewer -->
                            <div
                                class="bg-surface-light dark:bg-[#1d2832] rounded-xl border border-slate-200 dark:border-[#324d67] overflow-hidden shadow-sm animate-fade-in animate-fade-in-delay-1">
                                <div
                                    class="px-4 py-3 border-b border-slate-200 dark:border-[#324d67] bg-slate-50 dark:bg-[#111a22] flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <span class="material-symbols-outlined text-slate-500 text-lg">code</span>
                                        <span
                                            class="text-sm font-bold text-slate-700 dark:text-slate-200">deployment.yaml</span>
                                        <span
                                            class="text-xs px-2 py-0.5 rounded bg-slate-200 dark:bg-[#324d67] text-slate-600 dark:text-slate-300 font-mono">diff</span>
                                    </div>
                                    <div class="flex items-center gap-4 text-xs font-medium">
                                        <div class="flex items-center gap-1.5">
                                            <span class="size-2 rounded-full bg-red-500"></span>
                                            <span class="text-slate-500 dark:text-slate-400">Current</span>
                                        </div>
                                        <div class="flex items-center gap-1.5">
                                            <span class="size-2 rounded-full bg-green-500"></span>
                                            <span class="text-slate-500 dark:text-slate-400">AI Recommended</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 text-sm font-mono leading-relaxed bg-white dark:bg-[#0d1117] text-slate-800 dark:text-slate-300"
                                    id="yaml-diff">
                                    <!-- Populated by JS -->
                                </div>
                            </div>

                            <!-- Performance Impact Analysis -->
                            <div
                                class="bg-surface-light dark:bg-[#1d2832] rounded-xl border border-slate-200 dark:border-[#324d67] p-6 shadow-sm animate-fade-in animate-fade-in-delay-2">
                                <div class="flex justify-between items-center mb-6">
                                    <div>
                                        <h3 class="text-lg font-bold text-slate-900 dark:text-white">Performance Impact
                                            Analysis</h3>
                                        <p class="text-sm text-slate-500 dark:text-[#92adc9]">P95 Latency simulation
                                            with reduced resources</p>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <div class="flex items-center gap-2">
                                            <div class="w-3 h-0.5 bg-slate-400"></div>
                                            <span class="text-xs text-slate-500 font-medium">Historical Baseline</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <div class="w-3 h-0.5 bg-primary border-t border-dashed"></div>
                                            <span class="text-xs text-slate-500 font-medium">Projected (AI)</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="w-full h-48 relative">
                                    <svg class="w-full h-full overflow-visible" preserveAspectRatio="none"
                                        viewBox="0 0 800 200">
                                        <line class="text-slate-200 dark:text-slate-700" stroke="currentColor"
                                            stroke-width="1" x1="0" x2="800" y1="180" y2="180"></line>
                                        <line class="text-slate-200 dark:text-slate-700" stroke="currentColor"
                                            stroke-dasharray="4 4" stroke-width="1" x1="0" x2="800" y1="120" y2="120">
                                        </line>
                                        <line class="text-slate-200 dark:text-slate-700" stroke="currentColor"
                                            stroke-dasharray="4 4" stroke-width="1" x1="0" x2="800" y1="60" y2="60">
                                        </line>
                                        <text class="fill-slate-400 text-[10px]" x="0" y="175"
                                            font-family="Inter">200ms</text>
                                        <text class="fill-slate-400 text-[10px]" x="0" y="115"
                                            font-family="Inter">150ms</text>
                                        <text class="fill-slate-400 text-[10px]" x="0" y="55"
                                            font-family="Inter">100ms</text>
                                        <path class="text-slate-400" d="M30 140 Q 130 130, 230 150 T 400 140"
                                            fill="none" stroke="currentColor" stroke-width="2"></path>
                                        <path d="M400 140 Q 500 145, 600 135 T 780 130" fill="none" stroke="#137fec"
                                            stroke-dasharray="6 4" stroke-width="2"></path>
                                        <circle class="fill-slate-500" cx="400" cy="140" r="4"></circle>
                                        <circle class="fill-primary" cx="780" cy="130" r="4"></circle>
                                        <text class="text-xs fill-primary font-bold" x="740" y="120"
                                            id="projected-latency">142ms</text>
                                        <rect x="370" y="150" width="60" height="22" rx="4"
                                            class="fill-slate-800 dark:fill-slate-200"></rect>
                                        <text class="fill-white dark:fill-slate-900 text-[10px] font-bold"
                                            text-anchor="middle" x="400" y="165">Now</text>
                                    </svg>
                                    <div class="flex justify-between mt-2 text-xs text-slate-400 font-mono">
                                        <span>T-24h</span>
                                        <span>T-12h</span>
                                        <span>Now</span>
                                        <span>T+12h (Simulated)</span>
                                        <span>T+24h (Simulated)</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column (1/3) -->
                        <div class="flex flex-col gap-6">

                            <!-- CPU Usage vs Limits -->
                            <div
                                class="bg-surface-light dark:bg-[#1d2832] rounded-xl border border-slate-200 dark:border-[#324d67] p-5 shadow-sm animate-fade-in animate-fade-in-delay-1">
                                <h3 class="text-base font-bold text-slate-900 dark:text-white mb-1">CPU Usage vs Limits
                                </h3>
                                <p class="text-sm text-slate-500 mb-4">Last 30 Days</p>
                                <div class="relative h-40 w-full mb-4">
                                    <svg class="overflow-visible" fill="none" height="100%" preserveAspectRatio="none"
                                        viewBox="0 0 400 150" width="100%" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M0 120 C 50 120, 100 40, 150 40 C 200 40, 250 80, 300 80 S 350 20, 400 20 V 150 H 0 Z"
                                            fill="url(#gradient-cpu)" opacity="0.4"></path>
                                        <path
                                            d="M0 120 C 50 120, 100 40, 150 40 C 200 40, 250 80, 300 80 S 350 20, 400 20"
                                            fill="none" stroke="#137fec" stroke-width="2"></path>
                                        <line stroke="#ef4444" stroke-dasharray="4 2" stroke-width="1" x1="0" x2="400"
                                            y1="10" y2="10"></line>
                                        <line stroke="#22c55e" stroke-dasharray="4 2" stroke-width="1" x1="0" x2="400"
                                            y1="60" y2="60"></line>
                                        <defs>
                                            <linearGradient gradientUnits="userSpaceOnUse" id="gradient-cpu" x1="200"
                                                x2="200" y1="0" y2="150">
                                                <stop stop-color="#137fec" stop-opacity="0.5"></stop>
                                                <stop offset="1" stop-color="#137fec" stop-opacity="0"></stop>
                                            </linearGradient>
                                        </defs>
                                    </svg>
                                    <div class="absolute top-[8px] right-0 text-[10px] text-red-500 bg-surface-light dark:bg-[#1d2832] px-1"
                                        id="cpu-limit-current">Limit (Curr): ...</div>
                                    <div class="absolute top-[58px] right-0 text-[10px] text-green-600 bg-surface-light dark:bg-[#1d2832] px-1"
                                        id="cpu-limit-new">Limit (New): ...</div>
                                </div>
                                <div class="flex justify-between items-center text-sm">
                                    <span class="text-slate-500">Avg Usage</span>
                                    <span class="font-mono font-bold text-slate-900 dark:text-white"
                                        id="cpu-avg-usage">...</span>
                                </div>
                            </div>

                            <!-- AI Insights -->
                            <div class="flex flex-col gap-4 animate-fade-in animate-fade-in-delay-3">
                                <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider px-1">AI Insights &
                                    Tips</h3>
                                <div id="insights-container">
                                    <!-- Populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col gap-2"></div>

    <!-- GitHub Settings Modal -->
    <div id="github-modal"
        class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/50 backdrop-blur-sm">
        <div
            class="bg-surface-light dark:bg-[#1d2832] rounded-2xl w-full max-w-md mx-4 shadow-2xl border border-slate-200 dark:border-[#324d67] animate-fade-in">
            <div class="flex items-center justify-between p-5 border-b border-slate-200 dark:border-[#324d67]">
                <div class="flex items-center gap-3">
                    <svg class="size-6 text-slate-900 dark:text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path clip-rule="evenodd"
                            d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.606 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.334.202 2.353.1 2.606.636.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                            fill-rule="evenodd"></path>
                    </svg>
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white">GitHub Configuration</h3>
                </div>
                <button onclick="closeGitHubModal()"
                    class="size-8 rounded-lg flex items-center justify-center text-slate-400 hover:text-slate-600 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-[#233648] transition-colors">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <form onsubmit="saveGitHubConfig(event)" class="p-5 space-y-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1.5">Personal Access
                        Token</label>
                    <input id="gh-token" type="password" required
                        class="w-full h-10 px-3 rounded-lg bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] text-sm text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-primary/50 focus:border-primary font-mono"
                        placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" />
                    <p class="text-xs text-slate-400 mt-1">Needs <code
                            class="bg-slate-100 dark:bg-[#233648] px-1 rounded">repo</code> scope. <a
                            href="https://github.com/settings/tokens/new" target="_blank"
                            class="text-primary hover:underline">Create one →</a></p>
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1.5">Repository
                        Owner</label>
                    <input id="gh-owner" type="text" required
                        class="w-full h-10 px-3 rounded-lg bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] text-sm text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-primary/50 focus:border-primary"
                        placeholder="mertkiziloglu" value="mertkiziloglu" />
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1.5">Repository
                        Name</label>
                    <input id="gh-repo" type="text" required
                        class="w-full h-10 px-3 rounded-lg bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] text-sm text-slate-900 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-primary/50 focus:border-primary"
                        placeholder="SaveYourMoney" value="SaveYourMoney" />
                </div>
                <div class="flex items-center gap-3 pt-2">
                    <button type="submit"
                        class="flex-1 h-11 rounded-lg bg-primary hover:bg-primary/90 text-white font-bold shadow-lg shadow-blue-500/20 transition-all transform active:scale-95">
                        Save & Create PR
                    </button>
                    <button type="button" onclick="closeGitHubModal()"
                        class="h-11 px-4 rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-700 dark:text-slate-300 font-bold hover:bg-slate-50 dark:hover:bg-[#233648] transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- PR Success Modal -->
    <div id="pr-success-modal"
        class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/50 backdrop-blur-sm">
        <div
            class="bg-surface-light dark:bg-[#1d2832] rounded-2xl w-full max-w-md mx-4 shadow-2xl border border-slate-200 dark:border-[#324d67] animate-fade-in text-center p-8">
            <div
                class="size-16 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center mx-auto mb-4">
                <span class="material-symbols-outlined text-green-600 text-3xl">check_circle</span>
            </div>
            <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2">Pull Request Created!</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-1" id="pr-number-label">PR #0</p>
            <p class="text-xs text-slate-400 mb-6" id="pr-branch-label">branch-name</p>
            <div class="flex flex-col gap-3">
                <a id="pr-url-link" href="#" target="_blank"
                    class="h-11 rounded-lg bg-primary hover:bg-primary/90 text-white font-bold shadow-lg shadow-blue-500/20 transition-all flex items-center justify-center gap-2">
                    <svg class="size-5" fill="currentColor" viewBox="0 0 24 24">
                        <path clip-rule="evenodd"
                            d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.606 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.334.202 2.353.1 2.606.636.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                            fill-rule="evenodd"></path>
                    </svg>
                    View on GitHub
                </a>
                <button onclick="closePRSuccessModal()"
                    class="h-11 rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-700 dark:text-slate-300 font-bold hover:bg-slate-50 dark:hover:bg-[#233648] transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- API Scripts -->
    <script src="services/api.js"></script>
    <script src="services/github-api.js"></script>
    <script>
        const MOCK_DATA = {
            servicesAnalyzed: 3,
            totalMonthlySavings: 109.27,
            totalAnnualSavings: 1311.24,
            cpuHungryService: {
                serviceName: 'cpu-hungry-service',
                currentCpuRequest: '100m', currentCpuLimit: '200m',
                currentMemoryRequest: '256Mi', currentMemoryLimit: '512Mi',
                recommendedCpuRequest: '350m', recommendedCpuLimit: '700m',
                recommendedMemoryRequest: '256Mi', recommendedMemoryLimit: '384Mi',
                estimatedMonthlySavings: 35.50,
                p95CpuUsage: 87.5, p95MemoryUsage: 45.2,
                cpuThrottlingDetected: true, memoryLeakDetected: false
            },
            memoryLeakerService: {
                serviceName: 'memory-leaker-service',
                currentCpuRequest: '200m', currentCpuLimit: '400m',
                currentMemoryRequest: '256Mi', currentMemoryLimit: '512Mi',
                recommendedCpuRequest: '150m', recommendedCpuLimit: '300m',
                recommendedMemoryRequest: '384Mi', recommendedMemoryLimit: '576Mi',
                estimatedMonthlySavings: 42.15,
                p95CpuUsage: 35.8, p95MemoryUsage: 78.9,
                cpuThrottlingDetected: false, memoryLeakDetected: true
            },
            dbConnectionService: {
                serviceName: 'db-connection-service',
                currentCpuRequest: '150m', currentCpuLimit: '300m',
                currentMemoryRequest: '512Mi', currentMemoryLimit: '1Gi',
                recommendedCpuRequest: '200m', recommendedCpuLimit: '400m',
                recommendedMemoryRequest: '384Mi', recommendedMemoryLimit: '576Mi',
                estimatedMonthlySavings: 31.62,
                p95CpuUsage: 52.3, p95MemoryUsage: 62.1,
                cpuThrottlingDetected: false, memoryLeakDetected: false,
                connectionPoolExhaustion: true
            }
        };

        let currentService = null;
        let pendingPRAfterConfig = false;

        function getServiceFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('service') || 'cpu-hungry-service';
        }

        function findServiceData(data, serviceName) {
            for (const key of ['cpuHungryService', 'memoryLeakerService', 'dbConnectionService']) {
                if (data[key] && data[key].serviceName === serviceName) {
                    return data[key];
                }
            }
            return data.cpuHungryService;
        }

        // ─── GitHub Modal Controls ──────────────────────────

        function openGitHubModal() {
            const modal = document.getElementById('github-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');

            // Pre-fill from stored config
            const cfg = GitHubAPI.getConfig();
            if (cfg) {
                document.getElementById('gh-token').value = cfg.token || '';
                document.getElementById('gh-owner').value = cfg.owner || 'mertkiziloglu';
                document.getElementById('gh-repo').value = cfg.repo || 'SaveYourMoney';
            }
        }

        function closeGitHubModal() {
            const modal = document.getElementById('github-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            pendingPRAfterConfig = false;
        }

        async function saveGitHubConfig(e) {
            e.preventDefault();
            const token = document.getElementById('gh-token').value.trim();
            const owner = document.getElementById('gh-owner').value.trim();
            const repo = document.getElementById('gh-repo').value.trim();

            if (!token || !owner || !repo) {
                showToast('All fields are required', 'error');
                return;
            }

            GitHubAPI.configure(token, owner, repo);
            closeGitHubModal();
            showToast('GitHub configured successfully', 'success');

            // If we were pending a PR creation, execute it now
            if (pendingPRAfterConfig && currentService) {
                await executeCreatePR();
            }
        }

        function showPRSuccessModal(prUrl, prNumber, branchName) {
            document.getElementById('pr-number-label').textContent = `PR #${prNumber}`;
            document.getElementById('pr-branch-label').textContent = branchName;
            document.getElementById('pr-url-link').href = prUrl;

            const modal = document.getElementById('pr-success-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closePRSuccessModal() {
            const modal = document.getElementById('pr-success-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // ─── Create PR Flow ─────────────────────────────────

        async function createPR() {
            if (!GitHubAPI.isConfigured()) {
                pendingPRAfterConfig = true;
                openGitHubModal();
                return;
            }
            await executeCreatePR();
        }

        async function executeCreatePR() {
            if (!currentService) {
                showToast('No service data loaded', 'error');
                return;
            }

            // Find and disable the button
            const btn = document.querySelector('button[onclick="createPR()"]');
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<span class="material-symbols-outlined text-lg animate-spin">progress_activity</span> Creating PR...';
            }

            try {
                showToast('Creating branch and committing files...', 'info');
                const result = await GitHubAPI.createOptimizationPR(currentService);
                showPRSuccessModal(result.prUrl, result.prNumber, result.branchName);
                showToast(`PR #${result.prNumber} created successfully!`, 'success');
            } catch (error) {
                showToast(`PR creation failed: ${error.message}`, 'error');

                // If auth error, prompt config
                if (error.message.includes('401') || error.message.includes('403')) {
                    pendingPRAfterConfig = true;
                    setTimeout(() => openGitHubModal(), 1500);
                }
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.innerHTML = `<svg aria-hidden="true" class="size-5" fill="currentColor" viewBox="0 0 24 24"><path clip-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.606 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.334.202 2.353.1 2.606.636.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" fill-rule="evenodd"></path></svg> Create Pull Request`;
                }
            }
        }

        // ─── YAML Diff Viewer ───────────────────────────────

        function renderYamlDiff(service) {
            const container = document.getElementById('yaml-diff');
            const sharedLines = [
                'apiVersion: apps/v1',
                'kind: Deployment',
                'metadata:',
                `  name: ${service.serviceName}`,
                'spec:',
                '  template:',
                '    spec:',
                '      containers:',
                '      - name: main',
                '        resources:',
                '          requests:'
            ];

            const currentDiffLines = [
                { text: `            cpu: ${service.currentCpuRequest}`, type: 'remove' },
                { text: `            memory: ${service.currentMemoryRequest}`, type: 'remove' },
            ];
            const currentLimitLines = [
                { text: '          limits:', type: 'normal' },
                { text: `            cpu: ${service.currentCpuLimit}`, type: 'remove' },
                { text: `            memory: ${service.currentMemoryLimit}`, type: 'remove' },
            ];

            const recommendedDiffLines = [
                { text: `            cpu: ${service.recommendedCpuRequest}`, type: 'add' },
                { text: `            memory: ${service.recommendedMemoryRequest}`, type: 'add' },
            ];
            const recommendedLimitLines = [
                { text: '          limits:', type: 'normal' },
                { text: `            cpu: ${service.recommendedCpuLimit}`, type: 'add' },
                { text: `            memory: ${service.recommendedMemoryLimit}`, type: 'add' },
            ];

            function renderLine(line) {
                if (typeof line === 'string') {
                    return `<div class="opacity-50">${escapeHtml(line)}</div>`;
                }
                if (line.type === 'remove') {
                    return `<div class="bg-red-500/10 dark:bg-red-900/20 w-full block border-l-2 border-red-500 pl-1 text-red-700 dark:text-red-400 line-through decoration-red-500/50">${escapeHtml(line.text)}</div>`;
                }
                if (line.type === 'add') {
                    return `<div class="bg-green-500/10 dark:bg-green-900/20 w-full block border-l-2 border-green-500 pl-1 text-green-700 dark:text-green-400">${escapeHtml(line.text)}</div>`;
                }
                return `<div>${escapeHtml(line.text)}</div>`;
            }

            const leftHtml = [
                ...sharedLines.map(l => renderLine(l)),
                ...currentDiffLines.map(l => renderLine(l)),
                ...currentLimitLines.map(l => renderLine(l))
            ].join('');

            const rightHtml = [
                ...sharedLines.map(l => renderLine(l)),
                ...recommendedDiffLines.map(l => renderLine(l)),
                ...recommendedLimitLines.map(l => renderLine(l))
            ].join('');

            container.innerHTML = `
            <div class="border-r border-slate-200 dark:border-[#30363d] overflow-x-auto code-scroll p-4">${leftHtml}</div>
            <div class="overflow-x-auto code-scroll p-4 bg-slate-50/50 dark:bg-[#0d1117]">${rightHtml}</div>
        `;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ─── AI Insights ────────────────────────────────────

        function renderInsights(service) {
            const container = document.getElementById('insights-container');
            const insights = [];

            if (service.p95MemoryUsage < 50) {
                insights.push({
                    color: 'indigo',
                    icon: 'psychology',
                    title: 'Over-provisioned',
                    description: `This service has utilized <${Math.round(service.p95MemoryUsage)}% of its requested memory for the last 90 days. Reducing requests is safe.`
                });
            }

            if (service.cpuThrottlingDetected) {
                insights.push({
                    color: 'red',
                    icon: 'local_fire_department',
                    title: 'CPU Throttling Active',
                    description: `P95 CPU usage at ${service.p95CpuUsage}%. Current limits are too low — increase CPU limit to prevent request latency degradation.`
                });
            }

            if (service.memoryLeakDetected) {
                insights.push({
                    color: 'red',
                    icon: 'memory',
                    title: 'Memory Leak Pattern',
                    description: `Memory usage shows linear growth pattern reaching ${service.p95MemoryUsage}% of limits. Consider profiling and increasing memory limits as a stop-gap.`
                });
            }

            insights.push({
                color: 'amber',
                icon: 'speed',
                title: 'HPA Recommended',
                description: 'With tighter CPU limits, enable Horizontal Pod Autoscaling (HPA) to handle burst traffic safely.'
            });

            insights.push({
                color: 'slate',
                icon: 'security',
                title: 'QoS Class',
                description: 'Change will shift QoS from <code class="bg-slate-200 dark:bg-slate-700 px-1 rounded text-xs">Guaranteed</code> to <code class="bg-slate-200 dark:bg-slate-700 px-1 rounded text-xs">Burstable</code>. Ensure node capacity is sufficient.'
            });

            const colorMap = {
                indigo: { bg: 'bg-indigo-50 dark:bg-indigo-900/20', border: 'border-indigo-100 dark:border-indigo-800', icon: 'text-indigo-600 dark:text-indigo-400', title: 'text-indigo-900 dark:text-indigo-300', desc: 'text-indigo-700 dark:text-indigo-200' },
                amber: { bg: 'bg-amber-50 dark:bg-amber-900/10', border: 'border-amber-100 dark:border-amber-800', icon: 'text-amber-600 dark:text-amber-400', title: 'text-amber-900 dark:text-amber-300', desc: 'text-amber-700 dark:text-amber-200' },
                red: { bg: 'bg-red-50 dark:bg-red-900/20', border: 'border-red-100 dark:border-red-800', icon: 'text-red-600 dark:text-red-400', title: 'text-red-900 dark:text-red-300', desc: 'text-red-700 dark:text-red-200' },
                slate: { bg: 'bg-surface-light dark:bg-[#1d2832]', border: 'border-slate-200 dark:border-[#324d67]', icon: 'text-slate-400', title: 'text-slate-900 dark:text-white', desc: 'text-slate-500 dark:text-slate-400' },
            };

            container.innerHTML = insights.map(insight => {
                const c = colorMap[insight.color] || colorMap.slate;
                return `
                <div class="p-4 rounded-lg ${c.bg} border ${c.border} flex gap-3 shadow-sm mb-4">
                    <span class="material-symbols-outlined ${c.icon} shrink-0">${insight.icon}</span>
                    <div>
                        <h4 class="text-sm font-bold ${c.title} mb-1">${insight.title}</h4>
                        <p class="text-xs ${c.desc} leading-relaxed">${insight.description}</p>
                    </div>
                </div>
            `;
            }).join('');
        }

        // ─── Render Detail ──────────────────────────────────

        function renderDetail(service) {
            document.getElementById('breadcrumb-service').textContent = service.serviceName;
            document.getElementById('service-title').textContent = service.serviceName;

            const badge = document.getElementById('health-badge');
            const isCritical = (service.cpuThrottlingDetected && service.p95CpuUsage > 90) || (service.memoryLeakDetected && service.p95MemoryUsage > 85);
            const hasIssues = service.cpuThrottlingDetected || service.memoryLeakDetected || service.connectionPoolExhaustion;
            if (isCritical) {
                badge.className = 'px-2.5 py-0.5 rounded-full text-xs font-bold bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 border border-red-200 dark:border-red-800';
                badge.textContent = 'Critical';
            } else if (hasIssues) {
                badge.className = 'px-2.5 py-0.5 rounded-full text-xs font-bold bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400 border border-amber-200 dark:border-amber-800';
                badge.textContent = 'Warning';
            } else {
                badge.className = 'px-2.5 py-0.5 rounded-full text-xs font-bold bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 border border-green-200 dark:border-green-800';
                badge.textContent = 'Healthy';
            }

            document.getElementById('service-meta').innerHTML = `
            Namespace: <span class="font-mono text-slate-700 dark:text-slate-300">prod</span> •
            Strategy: <span class="font-mono text-slate-700 dark:text-slate-300">RollingUpdate</span> •
            Last deployed: <span class="text-slate-700 dark:text-slate-300">2h ago</span>
        `;

            document.getElementById('projected-savings').innerHTML = `-$${service.estimatedMonthlySavings.toFixed(2)}<span class="text-sm font-normal text-slate-400">/mo</span>`;

            document.getElementById('cpu-limit-current').textContent = `Limit (Curr): ${service.currentCpuLimit}`;
            document.getElementById('cpu-limit-new').textContent = `Limit (New): ${service.recommendedCpuLimit}`;

            const avgCpu = Math.round(parseInt(service.currentCpuRequest) * (service.p95CpuUsage / 100));
            document.getElementById('cpu-avg-usage').textContent = avgCpu + 'm';

            const baseLatency = 135;
            const projectedLatency = Math.round(baseLatency + (Math.random() * 15));
            document.getElementById('projected-latency').textContent = projectedLatency + 'ms';

            renderYamlDiff(service);
            renderInsights(service);
        }

        function dismissRecommendation() {
            showToast('Recommendation dismissed', 'info');
            setTimeout(() => { window.location.href = 'recommendations.html'; }, 1500);
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            if (!container) return;
            const colors = { success: 'bg-green-500', error: 'bg-red-500', info: 'bg-blue-500', warning: 'bg-amber-500' };
            const icons = { success: 'check_circle', error: 'error', info: 'info', warning: 'warning' };
            const toast = document.createElement('div');
            toast.className = `${colors[type] || colors.info} text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 transform transition-all duration-300 translate-x-full opacity-0`;
            toast.innerHTML = `<span class="material-symbols-outlined text-xl">${icons[type] || icons.info}</span><span class="font-medium">${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => toast.classList.remove('translate-x-full', 'opacity-0'), 10);
            setTimeout(() => { toast.classList.add('translate-x-full', 'opacity-0'); setTimeout(() => toast.remove(), 300); }, 3000);
        }

        // ─── Page Load ──────────────────────────────────────

        async function loadDetail() {
            const serviceName = getServiceFromUrl();
            let data = null;

            try {
                data = await API.getDashboard();
                if (!data || !data.servicesAnalyzed || data.servicesAnalyzed === 0) {
                    data = MOCK_DATA;
                }
            } catch {
                data = MOCK_DATA;
            }

            currentService = findServiceData(data, serviceName);
            renderDetail(currentService);
        }

        document.addEventListener('DOMContentLoaded', loadDetail);

        // Restore dark mode
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark');
        }
    </script>

</body>

</html>
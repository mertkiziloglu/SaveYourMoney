<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Cost Analysis - Save Your Money</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Noto+Sans:wght@400;500;700&family=Fira+Code:wght@400;500;600&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "surface-dark": "#1d2832",
                        "surface-light": "#ffffff",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"],
                        "mono": ["Fira Code", "monospace"],
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        .icon-filled {
            font-variation-settings: 'FILL' 1;
        }

        .code-scroll::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .code-scroll::-webkit-scrollbar-track {
            background: #1e293b;
        }

        .code-scroll::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white font-display transition-colors duration-200">
    <div class="flex h-screen w-full overflow-hidden">
        <!-- Sidebar -->
        <aside
            class="hidden md:flex flex-col w-64 h-full bg-surface-light dark:bg-[#111a22] border-r border-slate-200 dark:border-[#233648] shrink-0 z-20">
            <div class="p-6 flex items-center gap-3">
                <div class="size-8 bg-primary rounded-lg flex items-center justify-center text-white">
                    <span class="material-symbols-outlined text-xl">savings</span>
                </div>
                <span class="font-bold text-lg tracking-tight text-slate-900 dark:text-white">Save Your Money</span>
            </div>
            <nav class="flex-1 px-4 space-y-2 overflow-y-auto">
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-[#233648] group transition-colors"
                    href="index.html">
                    <span class="material-symbols-outlined group-hover:text-primary">dashboard</span>
                    <span class="text-sm font-medium">Dashboard</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-[#233648] group transition-colors"
                    href="deployments.html">
                    <span class="material-symbols-outlined group-hover:text-primary">layers</span>
                    <span class="text-sm font-medium">Deployments</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-[#233648] group transition-colors"
                    href="recommendations.html">
                    <span class="material-symbols-outlined group-hover:text-primary">auto_awesome</span>
                    <span class="text-sm font-medium">Recommendations</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-primary/10 text-primary dark:bg-[#233648] dark:text-white"
                    href="cost-analysis.html">
                    <span class="material-symbols-outlined icon-filled">attach_money</span>
                    <span class="text-sm font-medium">Cost Analysis</span>
                </a>
            </nav>
            <div class="p-4 border-t border-slate-200 dark:border-[#233648]">
                <div class="flex items-center gap-3">
                    <div
                        class="size-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold text-sm">
                        SY</div>
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-slate-900 dark:text-white">SaveYourMoney</span>
                        <span class="text-xs text-slate-500 dark:text-slate-400">DevOps Team</span>
                    </div>
                </div>
            </div>
        </aside>

        <div class="flex-1 flex flex-col h-full relative overflow-hidden">
            <!-- Header -->
            <header
                class="h-16 flex items-center justify-between px-6 bg-surface-light dark:bg-[#111a22] border-b border-slate-200 dark:border-[#233648] shrink-0">
                <div class="flex items-center gap-4">
                    <button class="md:hidden text-slate-500 hover:text-primary">
                        <span class="material-symbols-outlined">menu</span>
                    </button>
                    <div class="hidden md:flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400">
                        <span>Financials</span>
                        <span class="material-symbols-outlined text-[16px]">chevron_right</span>
                        <span class="text-slate-900 dark:text-white font-medium">Cost Analysis</span>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="refreshCostData()"
                        class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 hover:text-primary">
                        <span class="material-symbols-outlined text-[18px]">refresh</span>
                        Refresh
                    </button>
                    <button
                        onclick="document.documentElement.classList.toggle('dark');localStorage.setItem('theme',document.documentElement.classList.contains('dark')?'dark':'light')"
                        class="size-9 flex items-center justify-center rounded-full text-slate-500 hover:bg-slate-100 dark:hover:bg-[#233648] transition-colors"
                        title="Toggle Dark Mode">
                        <span class="material-symbols-outlined">dark_mode</span>
                    </button>
                    <button
                        class="size-9 flex items-center justify-center rounded-full text-slate-500 hover:bg-slate-100 dark:hover:bg-[#233648] transition-colors relative">
                        <span class="material-symbols-outlined">notifications</span>
                        <span
                            class="absolute top-2 right-2 size-2 bg-red-500 rounded-full border-2 border-white dark:border-[#111a22]"></span>
                    </button>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1 overflow-y-auto bg-background-light dark:bg-background-dark p-6 lg:px-10 pb-20">
                <div class="max-w-[1280px] mx-auto flex flex-col gap-6">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div
                            class="bg-surface-light dark:bg-[#1d2832] rounded-xl border border-slate-200 dark:border-[#324d67] p-6 shadow-sm flex flex-col justify-between h-32 relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-5">
                                <span
                                    class="material-symbols-outlined text-6xl text-slate-900 dark:text-white">payments</span>
                            </div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-sm font-medium text-slate-500 dark:text-slate-400">Monthly Cloud
                                    Spend</span>
                            </div>
                            <div class="flex items-end gap-3">
                                <span class="text-3xl font-black text-slate-900 dark:text-white"
                                    id="monthly-spend">$0.00</span>
                                <span
                                    class="flex items-center text-xs font-bold text-red-500 bg-red-50 dark:bg-red-900/20 px-1.5 py-0.5 rounded mb-1.5">
                                    <span class="material-symbols-outlined text-[14px] mr-0.5">trending_up</span> <span
                                        id="spend-change">0%</span>
                                </span>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 h-1 mt-auto rounded-full overflow-hidden">
                                <div class="bg-primary h-full rounded-full" style="width: 75%"></div>
                            </div>
                        </div>

                        <div
                            class="bg-surface-light dark:bg-[#1d2832] rounded-xl border border-slate-200 dark:border-[#324d67] p-6 shadow-sm flex flex-col justify-between h-32 relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-5">
                                <span class="material-symbols-outlined text-6xl text-green-600">savings</span>
                            </div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-sm font-medium text-slate-500 dark:text-slate-400">Potential Monthly
                                    Savings</span>
                            </div>
                            <div class="flex items-end gap-3">
                                <span class="text-3xl font-black text-green-600 dark:text-green-400"
                                    id="potential-savings">$0.00</span>
                                <span
                                    class="flex items-center text-xs font-bold text-green-600 bg-green-50 dark:bg-green-900/20 px-1.5 py-0.5 rounded mb-1.5"
                                    id="savings-percent">
                                    0% of spend
                                </span>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 h-1 mt-auto rounded-full overflow-hidden">
                                <div class="bg-green-500 h-full rounded-full" id="savings-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div
                            class="bg-surface-light dark:bg-[#1d2832] rounded-xl border border-slate-200 dark:border-[#324d67] p-6 shadow-sm flex flex-col justify-between h-32 relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-5">
                                <span class="material-symbols-outlined text-6xl text-blue-600">account_balance</span>
                            </div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-sm font-medium text-slate-500 dark:text-slate-400">Total Savings
                                    Realized (YTD)</span>
                            </div>
                            <div class="flex items-end gap-3">
                                <span class="text-3xl font-black text-blue-600 dark:text-blue-400"
                                    id="total-savings">$0</span>
                                <span class="text-xs text-slate-400 mb-1.5">since Jan 1st</span>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 h-1 mt-auto rounded-full overflow-hidden">
                                <div class="bg-blue-500 h-full rounded-full" style="width: 62%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div
                            class="lg:col-span-2 bg-surface-light dark:bg-[#1d2832] rounded-xl border border-slate-200 dark:border-[#324d67] p-6 shadow-sm">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h3 class="text-lg font-bold text-slate-900 dark:text-white">Spend over Time</h3>
                                    <p class="text-sm text-slate-500">Actual Spend vs. Projected with Optimization</p>
                                </div>
                                <div class="flex items-center gap-4">
                                    <div class="flex items-center gap-2">
                                        <span class="size-3 rounded-full bg-primary/20 border border-primary"></span>
                                        <span class="text-xs font-medium text-slate-600 dark:text-slate-300">Actual
                                            Cost</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span
                                            class="size-3 rounded-full bg-green-500/20 border border-green-500 border-dashed"></span>
                                        <span class="text-xs font-medium text-slate-600 dark:text-slate-300">Optimized
                                            (Projected)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="w-full h-64 relative">
                                <svg class="w-full h-full overflow-visible" preserveAspectRatio="none"
                                    viewBox="0 0 800 250">
                                    <line class="text-slate-100 dark:text-slate-700" stroke="currentColor"
                                        stroke-width="1" x1="0" x2="800" y1="200" y2="200"></line>
                                    <line class="text-slate-100 dark:text-slate-700" stroke="currentColor"
                                        stroke-width="1" x1="0" x2="800" y1="150" y2="150"></line>
                                    <line class="text-slate-100 dark:text-slate-700" stroke="currentColor"
                                        stroke-width="1" x1="0" x2="800" y1="100" y2="100"></line>
                                    <line class="text-slate-100 dark:text-slate-700" stroke="currentColor"
                                        stroke-width="1" x1="0" x2="800" y1="50" y2="50"></line>

                                    <path d="M0 160 L133 155 L266 150 L400 145 L533 140 L666 135 L800 130 V250 H0 Z"
                                        fill="url(#gradGreen)" opacity="0.2"></path>
                                    <path d="M0 160 L133 155 L266 150 L400 145 L533 140 L666 135 L800 130" fill="none"
                                        stroke="#22c55e" stroke-dasharray="6 4" stroke-width="2"></path>

                                    <path
                                        d="M0 160 C100 155, 133 120, 266 130 C350 140, 400 110, 533 90 C600 80, 666 70, 800 50 V250 H0 Z"
                                        fill="url(#gradBlue)" opacity="0.6"></path>
                                    <path
                                        d="M0 160 C100 155, 133 120, 266 130 C350 140, 400 110, 533 90 C600 80, 666 70, 800 50"
                                        fill="none" stroke="#137fec" stroke-width="3"></path>

                                    <circle class="fill-white stroke-primary stroke-2" cx="533" cy="90" r="5"></circle>
                                    <rect class="fill-slate-800 dark:fill-white" height="30" rx="4" width="100" x="480"
                                        y="45"></rect>
                                    <text class="fill-white dark:fill-slate-900 text-xs font-bold" text-anchor="middle"
                                        x="530" y="65" id="current-cost-label">$0</text>

                                    <defs>
                                        <linearGradient id="gradBlue" x1="0" x2="0" y1="0" y2="1">
                                            <stop offset="0%" stop-color="#137fec"></stop>
                                            <stop offset="100%" stop-color="#137fec" stop-opacity="0"></stop>
                                        </linearGradient>
                                        <linearGradient id="gradGreen" x1="0" x2="0" y1="0" y2="1">
                                            <stop offset="0%" stop-color="#22c55e"></stop>
                                            <stop offset="100%" stop-color="#22c55e" stop-opacity="0"></stop>
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <div class="flex justify-between mt-2 text-xs text-slate-400 font-medium">
                                    <span>Jan</span>
                                    <span>Feb</span>
                                    <span>Mar</span>
                                    <span>Apr</span>
                                    <span>May</span>
                                    <span>Jun</span>
                                    <span>Jul</span>
                                </div>
                            </div>
                        </div>

                        <div
                            class="bg-surface-light dark:bg-[#1d2832] rounded-xl border border-slate-200 dark:border-[#324d67] p-6 shadow-sm flex flex-col">
                            <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-6">Cost by Service</h3>
                            <div class="flex-1 flex flex-col items-center justify-center relative">
                                <svg class="transform -rotate-90" height="200" viewBox="0 0 200 200" width="200">
                                    <circle class="dark:stroke-slate-700" cx="100" cy="100" fill="none" r="70"
                                        stroke="#f1f5f9" stroke-width="20"></circle>
                                    <circle cx="100" cy="100" fill="none" r="70" stroke="#ef4444"
                                        stroke-dasharray="220 440" stroke-dashoffset="0" stroke-width="20"></circle>
                                    <circle cx="100" cy="100" fill="none" r="70" stroke="#137fec"
                                        stroke-dasharray="88 440" stroke-dashoffset="-220" stroke-width="20"></circle>
                                    <circle cx="100" cy="100" fill="none" r="70" stroke="#06b6d4"
                                        stroke-dasharray="66 440" stroke-dashoffset="-308" stroke-width="20"></circle>
                                    <circle cx="100" cy="100" fill="none" r="70" stroke="#22c55e"
                                        stroke-dasharray="66 440" stroke-dashoffset="-374" stroke-width="20"></circle>
                                </svg>
                                <div class="absolute inset-0 flex flex-col items-center justify-center">
                                    <span class="text-2xl font-black text-slate-900 dark:text-white"
                                        id="total-cost-center">$0</span>
                                    <span class="text-xs text-slate-500 uppercase font-bold tracking-wide">Total</span>
                                </div>
                            </div>
                            <div class="mt-6 space-y-3" id="service-breakdown">
                                <!-- Service breakdown will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Wasteful Resources Table -->
                    <div
                        class="bg-surface-light dark:bg-[#1d2832] rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm overflow-hidden">
                        <div
                            class="px-6 py-4 border-b border-slate-200 dark:border-[#324d67] flex justify-between items-center bg-slate-50/50 dark:bg-white/5">
                            <div>
                                <h3 class="text-lg font-bold text-slate-900 dark:text-white">Top Wasteful Resources</h3>
                                <p class="text-sm text-slate-500">Resources with highest idle cost or over-provisioning
                                </p>
                            </div>
                            <button class="text-sm font-medium text-primary hover:text-primary/80">View All
                                Resources</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead
                                    class="text-xs text-slate-500 uppercase bg-slate-50 dark:bg-[#111a22] border-b border-slate-200 dark:border-[#324d67]">
                                    <tr>
                                        <th class="px-6 py-3 font-medium">Resource Name</th>
                                        <th class="px-6 py-3 font-medium">Namespace</th>
                                        <th class="px-6 py-3 font-medium">Inefficiency</th>
                                        <th class="px-6 py-3 font-medium text-right">Wasted / Mo</th>
                                        <th class="px-6 py-3 font-medium text-right">Action</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100 dark:divide-[#233648]" id="wasteful-resources">
                                    <!-- Resources will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- API Scripts -->
    <script src="services/api.js"></script>
    <script>
        // Mock data fallback
        const MOCK_DATA = {
            servicesAnalyzed: 4,
            totalMonthlySavings: 97.00,
            totalAnnualSavings: 1164.00,
            cpuHungryService: {
                serviceName: 'cpu-hungry-service',
                currentCpuRequest: '100m',
                currentCpuLimit: '200m',
                currentMemoryRequest: '256Mi',
                currentMemoryLimit: '512Mi',
                recommendedCpuRequest: '350m',
                recommendedCpuLimit: '700m',
                recommendedMemoryRequest: '256Mi',
                recommendedMemoryLimit: '384Mi',
                estimatedMonthlySavings: -15.50,
                p95CpuUsage: 87.5,
                p95MemoryUsage: 45.2,
                cpuThrottlingDetected: true,
                memoryLeakDetected: false
            },
            memoryLeakerService: {
                serviceName: 'memory-leaker-service',
                currentCpuRequest: '200m',
                currentCpuLimit: '400m',
                currentMemoryRequest: '256Mi',
                currentMemoryLimit: '512Mi',
                recommendedCpuRequest: '150m',
                recommendedCpuLimit: '300m',
                recommendedMemoryRequest: '384Mi',
                recommendedMemoryLimit: '576Mi',
                estimatedMonthlySavings: -18.25,
                p95CpuUsage: 35.8,
                p95MemoryUsage: 78.9,
                cpuThrottlingDetected: false,
                memoryLeakDetected: true
            },
            dbConnectionService: {
                serviceName: 'db-connection-service',
                currentCpuRequest: '150m',
                currentCpuLimit: '300m',
                currentMemoryRequest: '512Mi',
                currentMemoryLimit: '1Gi',
                recommendedCpuRequest: '200m',
                recommendedCpuLimit: '400m',
                recommendedMemoryRequest: '384Mi',
                recommendedMemoryLimit: '576Mi',
                estimatedMonthlySavings: -11.75,
                p95CpuUsage: 52.3,
                p95MemoryUsage: 62.1,
                cpuThrottlingDetected: false,
                memoryLeakDetected: false,
                connectionPoolExhaustion: true
            },
            greedyService: {
                serviceName: 'greedy-service',
                currentCpuRequest: '1000m',
                currentCpuLimit: '2000m',
                currentMemoryRequest: '2Gi',
                currentMemoryLimit: '4Gi',
                recommendedCpuRequest: '100m',
                recommendedCpuLimit: '200m',
                recommendedMemoryRequest: '256Mi',
                recommendedMemoryLimit: '512Mi',
                estimatedMonthlySavings: 142.50,
                p95CpuUsage: 8.5,
                p95MemoryUsage: 12.3,
                cpuThrottlingDetected: false,
                memoryLeakDetected: false,
                connectionPoolExhaustion: false
            }
        };

        // Load cost analysis data
        async function loadCostData() {
            let data = null;
            try {
                data = await API.getDashboard();
                console.log('Cost data loaded:', data);

                // If API returns empty data, use mock data
                if (!data || !data.servicesAnalyzed || data.servicesAnalyzed === 0) {
                    console.warn('API returned empty data, using mock data');
                    data = MOCK_DATA;
                    showToast('Using demo data', 'info');
                }
            } catch (error) {
                console.warn('Failed to load from API, using mock data:', error.message);
                data = MOCK_DATA;
                showToast('Using demo data - Analyzer Service not available', 'warning');
            }

            if (data && data.servicesAnalyzed > 0) {
                // Calculate totals
                const monthlySpend = 500; // Base cost
                const monthlySavings = data.totalMonthlySavings || 0;

                // Calculate YTD: exact days elapsed since Jan 1st of current year
                const now = new Date();
                const startOfYear = new Date(now.getFullYear(), 0, 1);
                const msPerDay = 1000 * 60 * 60 * 24;
                const daysElapsed = Math.floor((now - startOfYear) / msPerDay);
                const dailySavings = monthlySavings / 30.44; // daily rate from monthly savings
                const ytdSavings = dailySavings * daysElapsed;

                // Calculate year progress for the progress bar
                const endOfYear = new Date(now.getFullYear(), 11, 31);
                const totalDaysInYear = Math.floor((endOfYear - startOfYear) / msPerDay) + 1;
                const yearProgress = ((daysElapsed / totalDaysInYear) * 100).toFixed(0);

                // Update summary cards
                document.getElementById('monthly-spend').textContent = '$' + monthlySpend.toFixed(2);
                document.getElementById('potential-savings').textContent = '$' + monthlySavings.toFixed(2);
                document.getElementById('total-savings').textContent = '$' + Math.round(ytdSavings);

                // Update YTD progress bar dynamically
                const ytdBar = document.querySelector('#total-savings').closest('.bg-surface-light, [class*="bg-surface"]').querySelector('.bg-blue-500');
                if (ytdBar) ytdBar.style.width = yearProgress + '%';

                const savingsPercent = ((monthlySavings / monthlySpend) * 100).toFixed(1);
                document.getElementById('savings-percent').textContent = savingsPercent + '% of spend';
                document.getElementById('savings-bar').style.width = savingsPercent + '%';

                document.getElementById('current-cost-label').textContent = '$' + (monthlySpend - monthlySavings).toFixed(0);
                document.getElementById('total-cost-center').textContent = '$' + Math.round(monthlySpend);

                // Populate service breakdown
                const breakdown = document.getElementById('service-breakdown');
                breakdown.innerHTML = '';

                const services = [
                    { name: 'greedy-service', data: data.greedyService, color: 'bg-red-500', percent: 50 },
                    { name: 'cpu-hungry-service', data: data.cpuHungryService, color: 'bg-primary', percent: 20 },
                    { name: 'memory-leaker-service', data: data.memoryLeakerService, color: 'bg-cyan-500', percent: 15 },
                    { name: 'db-connection-service', data: data.dbConnectionService, color: 'bg-green-500', percent: 15 }
                ];

                services.forEach(service => {
                    if (service.data) {
                        breakdown.innerHTML += `
                            <div class="flex items-center justify-between text-sm">
                                <div class="flex items-center gap-2">
                                    <span class="size-3 rounded-full ${service.color}"></span>
                                    <span class="text-slate-600 dark:text-slate-300">${service.name}</span>
                                </div>
                                <span class="font-bold text-slate-900 dark:text-white">${service.percent}%</span>
                            </div>
                        `;
                    }
                });

                // Populate wasteful resources table
                const tbody = document.getElementById('wasteful-resources');
                tbody.innerHTML = '';

                ['greedyService', 'cpuHungryService', 'memoryLeakerService', 'dbConnectionService'].forEach(key => {
                    if (data[key]) {
                        const service = data[key];
                        const isGreedy = service.serviceName === 'greedy-service';
                        const issueType = isGreedy ? 'Massively Over-provisioned' :
                            service.cpuThrottlingDetected ? 'Under-provisioned CPU' :
                                service.memoryLeakDetected ? 'Memory Leak Risk' :
                                    service.connectionPoolExhaustion ? 'Connection Pool Issue' : 'Idle Resources';

                        const issueClass = isGreedy ?
                            'bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400 border-red-100 dark:border-red-900' :
                            service.cpuThrottlingDetected || service.memoryLeakDetected ?
                                'bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-400 border-amber-100 dark:border-amber-900' :
                                'bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-400 border-amber-100 dark:border-amber-900';

                        tbody.innerHTML += `
                            <tr class="bg-white dark:bg-[#1d2832] hover:bg-slate-50 dark:hover:bg-[#233648] transition-colors">
                                <td class="px-6 py-4 font-medium text-slate-900 dark:text-white">
                                    <div class="flex items-center gap-2">
                                        <span class="material-symbols-outlined text-slate-400 text-lg">dns</span>
                                        ${service.serviceName}
                                    </div>
                                </td>
                                <td class="px-6 py-4 text-slate-500">prod</td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium ${issueClass} border">
                                        ${issueType}
                                    </span>
                                </td>
                                <td class="px-6 py-4 text-right font-mono font-bold ${service.estimatedMonthlySavings >= 0 ? 'text-green-600' : 'text-red-500'}">
                                    ${service.estimatedMonthlySavings >= 0 ? '+' : '-'}$${Math.abs(service.estimatedMonthlySavings).toFixed(2)}
                                </td>
                                <td class="px-6 py-4 text-right">
                                    <button onclick="window.location.href='recommendation-detail.html?service=${service.serviceName}'" class="text-primary hover:underline font-medium">Optimize</button>
                                </td>
                            </tr>
                        `;
                    }
                });
            }
        }

        function showToast(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-amber-500'
            };
            const icons = {
                success: 'check_circle',
                error: 'error',
                info: 'info',
                warning: 'warning'
            };

            // Create toast container if not exists
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'fixed bottom-4 right-4 z-50 flex flex-col gap-2';
                document.body.appendChild(container);
            }

            const toast = document.createElement('div');
            toast.className = `${colors[type] || colors.info} text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 transform transition-all duration-300 translate-x-full opacity-0`;
            toast.innerHTML = `
            <span class="material-symbols-outlined text-xl">${icons[type] || icons.info}</span>
            <span class="font-medium">${message}</span>
        `;

            container.appendChild(toast);
            setTimeout(() => toast.classList.remove('translate-x-full', 'opacity-0'), 10);
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function refreshCostData() {
            loadCostData();
        }

        // Auto-load on page load
        document.addEventListener('DOMContentLoaded', loadCostData);

        // Restore dark mode preference
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark');
        }
    </script>

</body>

</html>